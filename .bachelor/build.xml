<?xml version="1.0" encoding="UTF-8"?>
<project name="ontraport-3.0-selenium" default="build-sanity" basedir="..">

  <!--
   =============================================================================
   = Preferences
   =============================================================================
  -->

  <presetdef name="javac">
    <javac includeantruntime="false" />
  </presetdef>

  <!--
   =============================================================================
   = Re-Usable Variables
   =============================================================================
  -->

  <property name="browse" value="${basedir}/.bachelor/browse"/>
  <property name="config" value="${basedir}/.bachelor/config"/>
  <property name="output" value="${basedir}/.bachelor/output"/>
  <property name="report" value="${basedir}/.bachelor/report"/>

  <!--
   =============================================================================
   = Build Tasks
   =============================================================================
  -->

	  <target name="build-sanity" description="Run tools in sequence.">
	    <antcall target='prepare'/>
	    <antcall target='sanity'/>
	  </target>

	  <target name="build-review" description="Run tools in sequence.">
	    <antcall target='prepare'/>
	    <antcall target='review'/>
	  </target>

  <!--
   =============================================================================
   = Build Preparation
   =============================================================================
  -->

  <target name="clean" description="Cleanup build artifacts">
    <delete dir="${basedir}/bin" />
    <delete dir="${browse}"/>
    <delete dir="${output}"/>
    <delete dir="${report}"/>
  </target>

  <target name="prepare" depends="clean" description="Prepare for build">
    <mkdir dir="${basedir}/bin" />
    <mkdir dir="${browse}"/>
    <mkdir dir="${output}"/>
    <mkdir dir="${report}/selenium/xml"/>
    <mkdir dir="${report}/selenium/html"/>
  </target>

  <!--
   =============================================================================
   = Selenium
   =============================================================================
  -->

<!-- This may be unnecessary:
  <path id="test.classpath">
    <pathelement location="${basedir}/bin" />
    <fileset dir="${config}/selenium/lib">
      <include name="**/*.jar"/>
    </fileset>
  </path>
-->

  <target name="compile">
    <javac source="1.6" srcdir="${basedir}/src" fork="true" destdir="${basedir}/bin">
      <classpath>
        <pathelement path="${basedir}/bin"/>
        <fileset dir="${basedir}/lib">
          <include name="**/*.jar"/>
        </fileset>
      </classpath>
    </javac>
  </target>

	  <target name="sanity" depends="compile">
	    <junit printsummary="yes" haltonfailure="no">
	      <classpath>
	        <pathelement location="${basedir}/bin"/>
	        <fileset dir="${basedir}/lib">
	          <include name="**/*.jar"/>
	        </fileset>
	      </classpath>
	      <test name="com.ontraport.app.selenium.suites.Sanity" haltonfailure="no" todir="${report}/selenium/xml/sanity" outfile="TEST-Sanity">
	        <formatter type="xml"/>
	      </test>
	    </junit>
	    <junitreport todir="${report}/selenium/xml/sanity">
	      <fileset dir="${report}/selenium/xml/sanity">
	        <include name="TEST*.xml"/>
	      </fileset>
	      <report format="frames" todir="${report}/selenium/html/sanity"/>
	    </junitreport>
	  </target>

	  <target name="review" depends="compile">
	    <junit printsummary="yes" haltonfailure="no">
	      <classpath>
	        <pathelement location="${basedir}/bin"/>
	        <fileset dir="${basedir}/lib">
	          <include name="**/*.jar"/>
	        </fileset>
	      </classpath>
	      <test name="com.ontraport.app.selenium.suites.Review" haltonfailure="no" todir="${report}/selenium/xml/review" outfile="TEST-Review">
	        <formatter type="xml"/>
	      </test>
	    </junit>
	    <junitreport todir="${report}/selenium/xml/review">
	      <fileset dir="${report}/selenium/xml/review">
	        <include name="TEST*.xml"/>
	      </fileset>
	      <report format="frames" todir="${report}/selenium/html/review"/>
	    </junitreport>
	  </target>

</project>
